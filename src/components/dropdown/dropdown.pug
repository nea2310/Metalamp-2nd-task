include ../button/button.pug

mixin dropdown(options = {})
  -
    function getValidValue (list, value, defaultValue) {
      return value = list.includes(value) ? value : defaultValue
    }

    let {type = 'dropDownGuests', width = 'wide'} = options
    const {categories = [], 
      placeholder = '', 
      hasButtons = false, 
      labelText = ''} = options

    const elementName = 'dropdown'

    const minus = '-'
    const plus = '+'

    const validWidths = ['wide', 'narrow']
    width = getValidValue(validWidths, width, 'wide')
    const inputWidth = `_width_${width}`

    const validTypes = ['dropDownGuests', 'dropDownRooms']
    type = getValidValue(validTypes, type, 'dropDownGuests')
    const inputStyle = type=='dropDownRooms' ? '_not-rounded' : '_rounded'

  div(class = `${elementName} js-${elementName} ${elementName}${inputWidth}`)
    div(class = `${elementName}__input-wrapper`)
      label(class = `${elementName}__label`)
        if labelText
          p(class = `${elementName}__label-text`)= labelText
          image(class = `${elementName}__image js-${elementName}__image ${elementName}__image_collapsed`
            src = require('@com/dropdown/image/expand-more.svg')  alt = 'раскрывающийся список')
          input(class = `${elementName}__input js-${elementName}__input ${elementName}__input_collapsed ${elementName}__input${inputStyle}`
            readonly = true value = '' placeholder = placeholder type = 'text')
    div(class = `${elementName}__list-wrapper js-${elementName}__list-wrapper ${elementName}__list-wrapper_hidden`)
      ul(class = `${elementName}__list`)
        if Array.isArray(categories) && categories.length
          each value in categories
            - const {displayName = '', categoryType = '', declensions = '', defaultCount = 0, minCount = 0, maxCount = 99} = value
            li(class = `${elementName}__category-wrapper js-${elementName}__category-wrapper`)
              p(class = `${elementName}__category js-${elementName}__category`
                data-type = categoryType data-declensions = declensions)= displayName
              div(class = `${elementName}__count-wrapper`)
                button(class = `${elementName}__count-decrement js-${elementName}__count-decrement`
                  data-min = minCount type = 'button' aria-label = 'уменьшить количество')= minus
                span(class = `${elementName}__count-value js-${elementName}__count-value`)= defaultCount
                button(class = `${elementName}__count-increment js-${elementName}__count-increment`
                  data-max = maxCount type = 'button' aria-label = 'увеличить количество')= plus
      if (hasButtons)
        div(class = `${elementName}__buttons`)
          div(class = `${elementName}__button-clear js-${elementName}__button-clear`)
            +button({text: 'очистить', type: 'plain-text'})
          div(class = `${elementName}__button-apply js-${elementName}__button-apply`)
            +button({text: 'применить', type: 'plain-text'})